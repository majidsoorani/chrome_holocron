<!DOCTYPE html>
<html>
<head>
  <title>Holocron Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <h1>Holocron Settings</h1>

    <div class="form-section">
      <h2>Connection Monitoring</h2>
      <div class="form-group">
        <label for="ssh-command">SSH Process Identifier</label>
        <input type="text" id="ssh-command" placeholder="e.g., holocron-tunnel">
        <small>A unique string used to identify the tunnel process. The script uses this to create a unique tag for the SSH command.</small>
      </div>
      <div class="form-group">
        <label for="ping-host">TCP Ping Host</label>
        <input type="text" id="ping-host" placeholder="e.g., youtube.com">
        <small>A reliable host for a low-level TCP connection check.</small>
      </div>
      <div class="form-group">
        <label for="web-check-url">Web Check URL</label>
        <input type="text" id="web-check-url" placeholder="e.g., https://gemini.google.com/app">
        <small>A full URL to check for application-level connectivity through the tunnel.</small>
      </div>
    </div>

    <div class="form-section">
      <h2>Automatic Connection Networks (Optional)</h2>
      <small>The tunnel will only auto-connect on these Wi-Fi networks. Leave this section empty to disable the check and allow manual connection from any network.</small>
      <fieldset class="wifi-networks-section">
        <legend>Permitted SSIDs</legend>
        <div id="wifi-networks-list">
          <!-- SSIDs will be dynamically inserted here -->
        </div>
        <button id="add-wifi-button" class="button-secondary">Add Wi-Fi Network</button>
      </fieldset>
    </div>

    <div class="form-section">
      <h2>SSH Tunnel Configuration</h2>
      <div class="form-group">
        <label for="ssh-user">SSH User</label>
        <input type="text" id="ssh-user" placeholder="e.g., ubuntu">
      </div>
      <div class="form-group">
        <label for="ssh-host">SSH Host (Bastion)</label>
        <input type="text" id="ssh-host" placeholder="e.g., bastion.example.com">
      </div>

      <div class="form-group">
        <label for="auto-reconnect-enabled">Automatic Reconnect</label>
        <div class="checkbox-container">
            <input type="checkbox" id="auto-reconnect-enabled">
            <label for="auto-reconnect-enabled" class="checkbox-label">
                Automatically attempt to reconnect the tunnel if it disconnects.
            </label>
        </div>
        <small>If the tunnel process stops unexpectedly, the extension will try to restart it. This respects the Wi-Fi network rules.</small>
      </div>

      <fieldset class="port-forwarding-section">
        <legend>Port Forwarding Rules</legend>
        <div id="port-forwarding-rules">
          <!-- Rules will be dynamically inserted here -->
        </div>
        <button id="add-rule-button" class="button-secondary">Add Rule</button>
      </fieldset>
    </div>

    <div class="form-section">
      <h2>Proxy &amp; Routing</h2>
      <div class="form-group">
        <label for="geoip-bypass-enabled">GeoIP Bypass</label>
        <div class="checkbox-container">
            <input type="checkbox" id="geoip-bypass-enabled">
            <label for="geoip-bypass-enabled" class="checkbox-label">
                Enable proxy bypass for traffic to Iran (GeoIP).
            </label>
        </div>
        <small>When enabled, the browser proxy will not be used for sites hosted on Iranian IP ranges. This setting takes effect the next time you apply the proxy.</small>
      </div>
    </div>

    <div class="actions">
      <button id="save-button" class="button-primary">Save Settings</button>
      <button id="test-button" class="button-secondary">Test Connection</button>
    </div>
    <div id="status-message"></div>
  </div>

  <template id="port-forward-rule-template">
    <div class="rule-item">
      <select class="rule-type"><option value="L">Local (-L)</option><option value="D">Dynamic (-D)</option></select>
      <input type="text" class="rule-local-port" placeholder="Local Port">
      <span class="rule-colon">:</span>
      <input type="text" class="rule-remote-host" placeholder="Remote Host">
      <span class="rule-colon">:</span>
      <input type="text" class="rule-remote-port" placeholder="Remote Port">
      <button class="remove-rule-button" title="Remove Rule">&times;</button>
    </div>
  </template>

  <template id="wifi-network-template">
    <div class="rule-item">
      <input type="text" class="wifi-ssid-input" placeholder="e.g., MyWorkWifi-5G">
      <button class="remove-rule-button" title="Remove SSID">&times;</button>
    </div>
  </template>

  <script src="constants.js"></script>
  <script src="options.js"></script>
</body>
