<!DOCTYPE html>
<html>
<head>
  <title>Holocron Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="container">
    <h1>Holocron Settings</h1>

    <div class="form-section">
      <h2>Connection Mode</h2>
      <div class="form-group mode-selector">
        <input type="radio" id="mode-ssh" name="connection-mode" value="ssh" checked>
        <label for="mode-ssh">SSH Tunnel</label>
        <input type="radio" id="mode-v2ray" name="connection-mode" value="v2ray">
        <label for="mode-v2ray">V2Ray</label>
      </div>
    </div>

    <div class="form-section">
      <h2>Connection Monitoring</h2>
      <div class="form-group">
        <label for="ssh-command">SSH Process Identifier</label>
        <input type="text" id="ssh-command" placeholder="e.g., holocron-tunnel">
        <small>A unique string used to identify the tunnel process. The script uses this to create a unique tag for the SSH command.</small>
      </div>
      <div class="form-group">
        <label for="ping-host">TCP Ping Host</label>
        <input type="text" id="ping-host" placeholder="e.g., youtube.com">
        <small>A reliable host for a low-level TCP connection check.</small>
      </div>
      <div class="form-group">
        <label for="web-check-url">Web Check URL</label>
        <input type="text" id="web-check-url" placeholder="e.g., https://gemini.google.com/app">
        <small>A full URL to check for application-level connectivity through the tunnel.</small>
      </div>
    </div>

    <div class="form-section">
      <h2>Automatic Connection Networks (Optional)</h2>
      <small>The tunnel will only auto-connect on these Wi-Fi networks. Leave this section empty to disable the check and allow manual connection from any network.</small>
      <fieldset class="wifi-networks-section">
        <legend>Permitted SSIDs</legend>
        <div id="wifi-networks-list">
          <!-- SSIDs will be dynamically inserted here -->
        </div>
        <button id="add-wifi-button" class="button-secondary">Add Wi-Fi Network</button>
      </fieldset>
    </div>

    <div id="ssh-settings-container">
      <div class="form-section">
        <h2>SSH Tunnel Configuration</h2>
        <div class="form-group">
          <label for="ssh-user">SSH User</label>
          <input type="text" id="ssh-user" placeholder="e.g., ubuntu">
        </div>
        <div class="form-group">
          <label for="ssh-host">SSH Host (Bastion)</label>
          <input type="text" id="ssh-host" placeholder="e.g., bastion.example.com">
        </div>

        <div class="form-group">
          <label for="auto-reconnect-enabled">Automatic Reconnect</label>
          <div class="checkbox-container">
              <input type="checkbox" id="auto-reconnect-enabled">
              <label for="auto-reconnect-enabled" class="checkbox-label">
                  Automatically attempt to reconnect the tunnel if it disconnects.
              </label>
          </div>
          <small>If the tunnel process stops unexpectedly, the extension will try to restart it. This respects the Wi-Fi network rules.</small>
        </div>

        <fieldset class="port-forwarding-section">
          <legend>Port Forwarding Rules</legend>
          <div id="port-forwarding-rules">
            <!-- Rules will be dynamically inserted here -->
          </div>
          <button id="add-rule-button" class="button-secondary">Add Rule</button>
        </fieldset>
      </div>
    </div>

    <div id="v2ray-settings-container" style="display: none;">
      <div class="form-section">
        <h2>V2Ray Configuration</h2>
        <div class="form-group">
          <label for="v2ray-host">Server Address</label>
          <input type="text" id="v2ray-host" placeholder="e.g., v2.example.com">
        </div>
        <div class="form-group">
          <label for="v2ray-port">Server Port</label>
          <input type="text" id="v2ray-port" placeholder="e.g., 443">
        </div>
        <div class="form-group">
          <label for="v2ray-uuid">User ID (UUID)</label>
          <input type="text" id="v2ray-uuid" placeholder="Your V2Ray UUID">
        </div>
        <div class="form-group">
          <label for="v2ray-alterid">AlterId</label>
          <input type="text" id="v2ray-alterid" placeholder="e.g., 64">
        </div>
        <div class="form-group">
          <label for="v2ray-security">Security</label>
          <select id="v2ray-security">
            <option value="auto">auto</option>
            <option value="aes-128-gcm">aes-128-gcm</option>
            <option value="chacha20-poly1305">chacha20-poly1305</option>
            <option value="none">none</option>
          </select>
        </div>
        <div class="form-group">
          <label for="v2ray-network">Network</label>
          <select id="v2ray-network">
            <option value="tcp">tcp</option>
            <option value="ws">ws (WebSocket)</option>
          </select>
        </div>
        <div class="form-group">
          <label for="v2ray-socks-port">Local SOCKS Port</label>
          <input type="text" id="v2ray-socks-port" placeholder="e.g., 1080">
          <small>The local port on which V2Ray will listen for SOCKS5 proxy connections.</small>
        </div>
      </div>
    </div>

    <div class="form-section">
      <h2>Proxy &amp; Routing</h2>
      <div class="form-group">
        <label for="geoip-bypass-enabled">GeoIP Bypass</label>
        <div class="checkbox-container">
            <input type="checkbox" id="geoip-bypass-enabled">
            <label for="geoip-bypass-enabled" class="checkbox-label">
                Enable proxy bypass for traffic to Iran (GeoIP).
            </label>
        </div>
        <small>When enabled, the browser proxy will not be used for sites hosted on Iranian IP ranges. This setting takes effect the next time you apply the proxy.</small>
      </div>
    </div>

    <div class="actions">
      <button id="save-button" class="button-primary">Save Settings</button>
      <button id="test-button" class="button-secondary">Test Connection</button>
    </div>
    <div id="status-message"></div>
  </div>

  <template id="port-forward-rule-template">
    <div class="rule-item">
      <select class="rule-type"><option value="L">Local (-L)</option><option value="D">Dynamic (-D)</option></select>
      <input type="text" class="rule-local-port" placeholder="Local Port">
      <span class="rule-colon">:</span>
      <input type="text" class="rule-remote-host" placeholder="Remote Host">
      <span class="rule-colon">:</span>
      <input type="text" class="rule-remote-port" placeholder="Remote Port">
      <button class="remove-rule-button" title="Remove Rule">&times;</button>
    </div>
  </template>

  <template id="wifi-network-template">
    <div class="rule-item">
      <input type="text" class="wifi-ssid-input" placeholder="e.g., MyWorkWifi-5G">
      <button class="remove-rule-button" title="Remove SSID">&times;</button>
    </div>
  </template>

  <script src="constants.js"></script>
  <script src="options.js"></script>
</body>
